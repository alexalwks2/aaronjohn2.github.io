---
layout: post
comments: true
title:  "Cracking WPA and WPA2 Encryption by Exploiting WPS Using Reaver"
date:   2019-01-28 12:26:45
categories: Kali, WPS, WPA2, WPA, Encryption, Security, Reaver, MDK3, aircrack-ng
---

In this documentation I will discuss the steps to take on how to bypass issues that one would usually face when using Reaver to crack into routers that have Wifi Protected Setup (WPS) enabled.
Note: I will presume you have a wireless adapter that supports monitor mode and packet injection along with Kali Linux installed (or other penetration testing OS installed).

Below I have documented the process on how to use Reaver and bypass any issues when using it. Reaver is a tool that comes pre installed in Kali. and is used to implement a brute force attack against WPS registrar PIN (WPS uses a 8 digit pin) in order to recover the WPA/WPA2 passphrase. However, Reaver does not work against all routers. It only works against PBC (Push Button Configuration) authentication. Meaning the WPS router has to be configured for PBC.
* The below issues are documented in regards to a very secure router. Hence, you may experience these issues with Reaver or may not. With that noted, let's move on to the main course of this documentation.  

1. First we will go to terminal and run the wash command to find all WPS enabled routers around us.
```shell
wash -i wlan0
```
(The above command should give you a list of routers that have WPS enabled.)

2. Next, we will run Reaver against the target WPS enabled router.
```shell
reaver -b () -c () -i wlan0
```
(Note: in the above command -b is the bssid of the target router, -c is the channel of the router and -i is the interface of the wireless adapter; where in my case its wlan0.)

**If "Failed to associate" error shows up when running the Reaver command then do the following, else skip to step 4**

3. When "Failed to associate" warning shows up, we will manually associate with the target router to bypass this issue using aireplay-ng. In order to do this we will open another terminal window as shown below (I am using the terminator application which allows me to split windows). We will simultaneously run the Reaver command in one window and aireplay-ng in another window. We will pass the -A option in the Reaver command so that it does not associate with the target since we are doing it manually using aireplay-ng. As for the aireplay-ng command, we will do a fake authentication, setting a delay of 100 seconds before re-associating with the router.
* Now, we will get these two commands ready in separate windows as shown below. First we will run the Reaver command and then immediately after we will run the aireplay-ng command. This below method should succesfully help you bypass the "Failed to associate" issue.
```shell
reaver -b () -c () -i wlan0 -A -vvv
```
(Note: in the above command -vvv is to show verbose output on the screen. Which means everything that happens happens in the background of Reaver tool will be output to the screen. Type reaver --help in terminal for more info.)
```shell
aireplay-ng --fakeauth 100 -a () -h () wlan0
```
(Note: in the above command -a is the mac address of router -h is the mac address of your attack machine. In order to find your mac address, do ifconfig in terminal and if you see an unspec field, its the first 12 digits. Make sure to replace the '-' with a ':' when typing in the mac address for -h option.)

**If "WPS transaction failed (code: 0x02) or (code: 0x03), re-trying last pin" errors shows up when running the Reaver command then do the following, else skip to step 6**

4. When looking into the verbose information, Reaver seems to be stuck in a loop where it keeps re-trying the same PIN over and over again due to timeout. Since Reaver does not know if the PIN it tried is correct or Wrong it retries the same PIN again causing it to get stuck in a loop. Resulting in no progress.
```shell
reaver --help
```
(Note: we will use the option -N / --no-nacks to not send NACK messages, since this seems to be the issue that causes Reaver to get stuck in this loop.)

5. Run the below command simultaneously, by first running the Reaver command in one window and immediately running the aireplay-ng command after in another window. -N option for Reaver should successfully help us bypass the 0x02 and 0x03 error.
```shell
reaver -b () -c () -i wlan0 -A -vvv -N
```
```shell
aireplay-ng --fakeauth 100 -a() -h() wlan0
```
(Note: in the above commands we are associating reaver manually by using aireplay-ng which is why there is a -A option and -vvv is for verbose output.)

**If "WPS Lock : Yes" shows up in your wash command then do the following, else you are lucky!**

6. 
